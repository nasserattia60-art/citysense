{% extends "base/base.html" %}
{% load static %}
{% block title %}CitySense | city report{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/analysis/report.css' %}">
{% endblock %}

{% block content %}

<div class="report-container">
    <article class="report-card">

        <!-- Header -->
        <section>
            <h2>CitySense Report</h2>
            {% if report.avg_feedback_score %}
                <p><strong>AI Quality Score:</strong> {{ report.avg_feedback_score }}/5</p>
            {% endif %}
            <p><strong>Address:</strong> {{ report.location.address }}</p>
        </section>

        <!-- Core Metrics -->
        <section class="report-metrics">
            <div class="metric-card">
                <h4>Safety</h4>
                <p>{{ report.safety_score }}</p>
                <canvas id="chart-safety"></canvas>
            </div>

            <div class="metric-card">
                <h4>Noise</h4>
                <p>{{ report.noise_level }}</p>
                <canvas id="chart-noise"></canvas>
            </div>

            <div class="metric-card">
                <h4>Rent</h4>
                <p>{{ report.rent_level }}</p>
                <canvas id="chart-rent"></canvas>
            </div>

            <div class="metric-card">
                <h4>Water Quality</h4>
                <p>{{ report.water_quality }}</p>
                <canvas id="chart-water"></canvas>
            </div>

            <div class="metric-card">
                <h4>AI Score</h4>
                <p>{{ report.ai_score }}/100</p>
                <canvas id="chart-ai"></canvas>
            </div>
        </section>

        <!-- AI Summary -->
        <section class="report-summary">
            <p>{{ report.ai_summary }}</p>
            <a href="/community/feedback/{{ report.id }}/" class="report-link">
                Improve this analysis
            </a>
        </section>

        <!-- AI Extended Insights -->
        {% if report.city_name %}
        <section class="report-ai-details">
            <h3>AI Insights</h3>
            <ul>
                <li><strong>City:</strong> {{ report.city_name }}</li>
                <li><strong>Tourism Score:</strong> {{ report.tourism_score }}/100</li>
                <li><strong>Noise Level:</strong> {{ report.noise_level }}</li>
                <li><strong>Rent Level:</strong> {{ report.rent_level }}</li>
                <li><strong>Water Quality:</strong> {{ report.water_quality }}</li>
            </ul>
        </section>
        {% endif %}

        <!-- Attractions & History -->
        {% if report.top_attractions %}
        <section class="report-attractions">
            <h3>Top Attractions</h3>
            <ul>
                {% for item in report.top_attractions %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </section>
        {% endif %}

        {% if report.historical_landmarks %}
        <section class="report-attractions">
            <h3>Historical Landmarks</h3>
            <ul>
                {% for item in report.historical_landmarks %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </section>
        {% endif %}

        {% if report.cultural_notes %}
        <section class="report-cultural">
            <h3>Cultural Notes</h3>
            <p>{{ report.cultural_notes }}</p>
        </section>
        {% endif %}

        <!-- Weather Info -->
        {% if report.temperature %}
        <section class="report-weather">
            <h3>Weather Info</h3>
            <div class="report-metrics">

                <div class="metric-card">
                    <h4>Feels Like</h4>
                    <p>{{ report.temperature }} Â°C</p>
                </div>

                <div class="metric-card">
                    <h4>Wind Speed</h4>
                    <p>{{ report.windspeed }} km/h</p>
                </div>

                <div class="metric-card">
                    <h4>Weather Code</h4>
                    <p>{{ report.weather_code }}</p>
                </div>

                {% if report.weather_risk_level %}
                <div class="metric-card">
                    <h4>Weather Risk</h4>
                    <p>{{ report.weather_risk_level }}</p>
                </div>
                {% endif %}

                {% if report.min_visibility_km %}
                <div class="metric-card">
                    <h4>Visibility</h4>
                    <p>{{ report.min_visibility_km }} km</p>
                </div>
                {% endif %}

            </div>
        </section>
        {% endif %}

    </article>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/analysis/report.js' %}"></script>
{% endblock %}
