{% extends "base/base.html" %}
{% load static %}
{% block title %}CitySense | profile {% endblock %}
{% block extra_css %}
<link rel="stylesheet" href=" {% static 'css/users/profile.css' %}">
{% endblock %}
{% block content %}

<div class="dashboard">

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2 class="logo">CitySense</h2>
        <ul class="menu">
            <li class="active">Profile</li>
            <li><a href="{% url 'reports:reports' %}" style='text-decoration: none;color: #fff;'>Reports</a></li>
            
            <li>
                <button id="open-profile-modal" class="btn primary">
    Edit Profile
</button>
            </li>
            <li>
              <form method="post" action="{% url 'users:logout' %}">
                {% csrf_token %}
                <button type="submit"  class='bt_fo'>Logout</button>
              </form>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="content">

        <!-- Profile Header -->
        <section class="profile-header">
            <div class="avatar-ring ">
                <div class="avatar-img">
                {% if context.profile.avatar %}
                    <img src="{{ context.profile.avatar.url }}" alt="User Avatar">
                    <span class="online-dot"></span>
                {% else %}
                    <img src="{% static 'images/default-avatar.jpg' %}" alt="Avatar">
                    <span class="online-dot"></span>
                {% endif %}
                
                </div>
            </div>
         
            <div class="info">
                <h1>{{ context.user.username }}</h1>
              
            </div>
        </section>

        <!-- Profile Details -->
        <section class="profile-details">
            <div class="card">
                <h3>Email</h3>
                <p>{{ context.user.email }}</p>
            </div>

            <div class="card">
                <h3>Location</h3>
                <p>{{ context.profile.city|default:"Not set"  }}</p>
            </div>

            <div class="card">
                <h3>Member Since</h3>
                <p>{{ context.user.date_joined|date:"M Y" }}</p>
            </div>
        </section>

        <!-- About -->
        <section class="about">
            <h2>About Me</h2>
            {% if context.profile.bio %}
                <p>{{ context.profile.bio }}</p>
            {% else %}
                <p style="color: #999; font-style: italic;">No bio added yet. Click "Edit Profile" to add one.</p>
            {% endif %}
        </section>
        
    </main>
    
</div>


   
<div id="profile-modal" class="modal hidden">
    <div class="modal-box">

        <h3>Edit Profile</h3>
        
        <form method="post" enctype="multipart/form-data" id="profile-form">
            {% csrf_token %}

            <!-- Bio Field -->
            <div class="form-group">
                <label for="{{ context.form.bio.id_for_label }}">Bio</label>
                {{ context.form.bio }}
                {% if context.form.bio.errors %}
                    <span class="form-error">
                        {% for error in context.form.bio.errors %}
                            {{ error }}
                        {% endfor %}
                    </span>
                {% endif %}
            </div>

            <!-- City Field -->
            <div class="form-group">
                <label for="{{ context.form.city.id_for_label }}">City</label>
                {{ context.form.city }}
                {% if context.form.city.errors %}
                    <span class="form-error">
                        {% for error in context.form.city.errors %}
                            {{ error }}
                        {% endfor %}
                    </span>
                {% endif %}
            </div>

            <!-- Avatar Field -->
            <div class="form-group">
                <label for="{{ context.form.avatar.id_for_label }}">Avatar</label>
                {% if context.profile.avatar %}
                    <div class="current-avatar">
                        <img src="{{ context.profile.avatar.url }}" alt="Current Avatar" style="max-width: 100px; border-radius: 50%;">
                        <p style="font-size: 0.85em; color: #999; margin-top: 5px;">Current avatar</p>
                    </div>
                {% endif %}
                {{ context.form.avatar }}
                {% if context.form.avatar.errors %}
                    <span class="form-error">
                        {% for error in context.form.avatar.errors %}
                            {{ error }}
                        {% endfor %}
                    </span>
                {% endif %}
            </div>

            <!-- Non-field errors -->
            {% if context.form.non_field_errors %}
                <div class="form-errors">
                    {% for error in context.form.non_field_errors %}
                        <p class="form-error">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="actions">
                <button type="submit" class="btn primary">Save</button>
                <button type="button" class="btn secondary" id="close-profile-modal">
                    Cancel
                </button>
            </div>
        </form>

    </div>
</div>
{% if context.form.errors %}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("profile-modal").classList.remove("hidden");
    });
</script>
{% endif %}


<script>
document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("profile-modal");

    document
        .getElementById("open-profile-modal")
        .addEventListener("click", () => {
            modal.classList.remove("hidden");
        });

    document
        .getElementById("close-profile-modal")
        .addEventListener("click", () => {
            modal.classList.add("hidden");
        });
});
</script>

{% endblock %}

{% block extra_js %}




{% endblock %}